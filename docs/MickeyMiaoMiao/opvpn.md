---
title: opvpn
tags:
  - 你的标签名字
# hide:
#   #- navigation # 显示右侧导航
#   #- toc #显示左侧导航
comments: true  #评论，默认不开启
---


## 1. 概述

OpenVPN 是一个开源的 VPN（虚拟专用网络）实现，用于创建安全的点对点或站点对站点连接。它使用自定义安全协议，该协议基于 SSL/TLS 协议进行加密和身份验证。OpenVPN 允许参与建立 VPN 的计算机在共享网络或公共互联网等不安全的网络上通过加密隧道进行安全通信。

## 2. 基本架构

OpenVPN 采用客户端/服务器架构，主要由以下组件构成：

- **OpenVPN 服务器**：接受来自多个客户端的连接，负责管理 VPN 网络
- **OpenVPN 客户端**：连接到 OpenVPN 服务器，通过服务器访问资源
- **虚拟网卡**：TUN/TAP 设备，用于创建虚拟网络接口
  - **TUN**：在 OSI 第 3 层(网络层)操作，传输 IP 数据包
  - **TAP**：在 OSI 第 2 层(数据链路层)操作，传输以太网帧

## 3. 工作原理

### 3.1 隧道建立过程

1. **初始连接**：
   - 客户端发起连接请求到服务器的指定端口(默认为 UDP 1194)
   - 客户端和服务器建立控制通道

2. **TLS 握手**：
   - 使用 SSL/TLS 协议进行双向认证
   - 服务器向客户端提供证书，客户端验证服务器身份
   - 客户端向服务器提供证书，服务器验证客户端身份
   - 生成会话密钥用于数据加密

3. **密钥交换**：
   - 协商加密算法和参数
   - 生成用于加密数据通道的共享密钥

4. **建立数据通道**：
   - 创建虚拟网络接口(TUN/TAP)
   - 分配 VPN IP 地址
   - 设置路由表

5. **数据传输**：
   - 普通数据包通过虚拟接口发送
   - 数据被加密并封装到 UDP 或 TCP 数据包中
   - 数据通过公共网络传输
   - 接收方解密数据并传递到目标

### 3.2 数据封装

OpenVPN 数据封装过程如下：

1. 应用程序生成数据包
2. 数据包被路由到虚拟 TUN/TAP 接口
3. OpenVPN 对数据包进行加密
4. 加密后的数据被封装到 UDP 或 TCP 包中
5. 封装后的数据通过实际物理接口发送
6. 接收方解封装并解密数据
7. 解密后的数据从虚拟接口发送到内部网络


[妙妙屋](https://raw.githubusercontent.com/angristan/openvpn-install/master/openvpn-install.sh)